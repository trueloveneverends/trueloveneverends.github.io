<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>张龙昊的深渊</title>
<style>
    :root {
        --gold-color: #ffc107; --dark-bg: #121212; --primary-bg: #1e1e1e;
        --secondary-bg: #2c2c2c; --text-color: #e0e0e0; --danger-color: #dc3545;
        --success-color: #28a745; --warning-color: #ff9800; --loan-color: #0dcaf0;
    }
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;700&display=swap');
    
    body {
        font-family: 'Noto Sans SC', sans-serif; background-color: var(--dark-bg);
        color: var(--text-color); margin: 0; overflow: hidden;
        background: url('https://images.unsplash.com/photo-1543722530-534b421487f2?q=80&w=1974&auto=format&fit=crop') no-repeat center center/cover;
        position: relative; height: 100vh;
    }
    body::before {
        content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        background-color: rgba(0,0,0,0.75); backdrop-filter: blur(5px); z-index: 1;
    }

    .container {
        display: flex; width: 100%; height: 100%; z-index: 2; position: relative;
    }

    .sidebar {
        width: 350px; background-color: rgba(28, 28, 28, 0.9);
        padding: 20px; box-shadow: 5px 0 15px rgba(0,0,0,0.5);
        display: flex; flex-direction: column; border-right: 1px solid var(--gold-color);
        overflow-y: auto; transition: width 0.3s ease;
    }
    .assets h2, .message-board h3 {
        color: var(--gold-color); border-bottom: 2px solid var(--gold-color);
        padding-bottom: 10px; margin-top: 0; font-weight: 700; text-align: center;
    }
    .asset-item {
        background-color: var(--secondary-bg); margin: 12px 0; padding: 15px;
        border-radius: 8px; display: flex; justify-content: space-between;
        align-items: center; transition: all 0.3s ease; border-left: 5px solid var(--gold-color);
    }
    .asset-item.sold-out, .asset-item.left { border-left-color: var(--danger-color); background-color: #444;}
    .asset-item.in-loan { border-left-color: var(--loan-color); }
    .asset-item span:first-child { font-weight: bold; }
    .asset-item .value { color: var(--success-color); font-weight: bold; }
    .asset-item .sold, .asset-item .left-text { color: var(--danger-color); font-weight: bold; }
    .asset-item .loan-text { color: var(--loan-color); font-weight: bold; }
    .asset-item .actions button {
        background-color: var(--danger-color); color: white; border: none; padding: 5px 8px;
        border-radius: 5px; cursor: pointer; font-size: 11px; margin-left: 5px;
    }
    .asset-item .actions button.loan-btn { background-color: var(--loan-color); }
    .asset-item .actions button:disabled { background-color: #6c757d; cursor: not-allowed; }

    .message-board {
        margin-top: 20px; background-color: rgba(0,0,0,0.4); padding: 15px;
        border-radius: 8px; flex-shrink: 0; height: 350px; overflow-y: auto;
    }
    #messages { list-style-type: none; padding: 0; margin: 0; font-size: 14px; }
    #messages li { margin-bottom: 10px; line-height: 1.6; color: #ccc; border-bottom: 1px solid #333; padding-bottom: 8px;}
    #messages li.warning { color: var(--warning-color); } #messages li.danger { color: var(--danger-color); }
    #messages li.success { color: var(--success-color); } #messages li.info { color: var(--loan-color); }

    .main-content { flex: 1; padding: 20px; display: flex; flex-direction: column; overflow: hidden; }
    .game-nav { display: flex; margin-bottom: 20px; background-color: rgba(0,0,0,0.5); border-radius: 10px; padding: 5px; }
    .game-nav button { flex: 1; padding: 15px 5px; font-size: 16px; font-weight: bold; background: transparent; color: #aaa; border: none; cursor: pointer; transition: all 0.3s ease; border-bottom: 3px solid transparent; }
    .game-nav button.active { color: var(--gold-color); border-bottom-color: var(--gold-color); }

    .game-view { display: none; background-color: rgba(44, 44, 44, 0.85); padding: 20px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; flex-grow: 1; overflow-y: auto; }
    .game-view.active { display: flex; flex-direction: column; }
    .game-view h1 { color: var(--gold-color); margin-top: 0; font-size: 2em; }

    /* Blackjack Styles */
    #blackjack-game .table { flex-grow: 1; display: flex; flex-direction: column; justify-content: space-around; }
    .hand-area { min-height: 100px; }
    .cards { display: flex; justify-content: center; flex-wrap: wrap; }
    .card {
        background-color: white; color: black; width: 60px; height: 90px;
        border-radius: 5px; border: 1px solid #888; margin: 5px;
        display: inline-flex; justify-content: center; align-items: center;
        font-size: 24px; font-weight: bold; position: relative;
        transform-style: preserve-3d; transition: transform 0.6s;
    }
    .card .suit { position: absolute; font-size: 12px; }
    .card .suit-top { top: 5px; left: 5px; }
    .card .suit-bottom { bottom: 5px; right: 5px; transform: rotate(180deg); }
    .card.red { color: #f00; }
    .card.back { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card.flipped { transform: rotateY(180deg); }
    .hand-value { font-size: 1.2em; font-weight: bold; margin-top: 10px; }

    .controls { margin-top: 20px; }
    .controls input { width: 120px; padding: 10px; border-radius: 5px; border: 2px solid #555; background-color: #333; color: white; font-size: 16px; text-align: center; }
    .controls button {
        padding: 10px 20px; font-size: 16px; font-weight: bold;
        background: linear-gradient(45deg, var(--gold-color), var(--warning-color));
        color: #111; border: none; border-radius: 5px; cursor: pointer;
        transition: all 0.3s ease; margin: 0 5px;
    }
    .controls button:disabled { background: #555; color: #888; cursor: not-allowed; }

    #final-message {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.97); color: white; flex-direction: column;
        justify-content: center; align-items: center; text-align: center; z-index: 1000;
        padding: 20px; box-sizing: border-box;
    }
    #final-message h1 { color: var(--danger-color); font-size: 3em; }
    #final-message p { font-size: 1.2em; max-width: 90%; margin: 20px 0; line-height: 1.7; }
    #restart-button { padding: 15px 40px; font-size: 1.2em; background-color: var(--gold-color); color: #111; border: none; border-radius: 5px; cursor: pointer; }

    /* Responsive Design for Mobile */
    @media (max-width: 768px) {
        .container { flex-direction: column; height: auto; min-height: 100vh;}
        .sidebar { width: 100%; height: auto; flex-direction: row; flex-wrap: wrap; justify-content: space-around; border-right: none; border-bottom: 1px solid var(--gold-color); box-sizing: border-box; }
        .assets, .message-board { width: 100%; box-sizing: border-box; }
        .message-board { margin-top: 10px; height: 200px; }
        .asset-item { flex-direction: column; align-items: center; text-align: center; padding: 10px; }
        .asset-item span:first-child { margin-bottom: 5px; }
        .asset-item .actions { margin-top: 5px; }
        .main-content { padding: 10px; flex-grow: 1; }
        .game-nav button { font-size: 14px; padding: 10px 2px; }
        .game-view { padding: 15px; }
        .game-view h1 { font-size: 1.5em; }
        .controls input { width: 100px; }
        .controls button { padding: 10px 15px; font-size: 14px; }
        .card { width: 45px; height: 70px; font-size: 18px; }
        #final-message h1 { font-size: 2.5em; }
        #final-message p { font-size: 1em; }
    }
    
    /* Mobile Landscape */
    @media (max-height: 500px) and (orientation: landscape) {
        .container { flex-direction: row; }
        .sidebar { width: 220px; justify-content: flex-start; }
        .assets, .message-board { width: 100%; }
        .message-board { height: 150px; }
        .asset-item { flex-direction: row; justify-content: space-between; }
        .asset-item span:first-child { margin-bottom: 0; }
        .asset-item .actions { margin-top: 0; }
        .main-content { flex-grow: 1; padding: 10px;}
        .game-view h1 { font-size: 1.2em; margin-bottom: 10px; }
        .card { width: 40px; height: 60px; font-size: 16px; margin: 2px;}
        .hand-area { min-height: 70px; }
        .controls { margin-top: 10px; }
        .controls input { width: 80px; padding: 8px; font-size: 12px;}
        .controls button { padding: 8px 12px; font-size: 12px; }
    }

</style>
</head>
<body>

<!-- Audio Files -->
<audio id="sound-bet" src="https://www.soundjay.com/buttons/sounds/button-16.mp3" preload="auto"></audio>
<audio id="sound-win" src="https://www.soundjay.com/misc/sounds/coins-in-hand-2.mp3" preload="auto"></audio>
<audio id="sound-lose" src="https://www.soundjay.com/misc/sounds/remove-file-1.mp3" preload="auto"></audio>
<audio id="sound-card" src="https://www.soundjay.com/misc/sounds/page-flip-02.mp3" preload="auto"></audio>
<audio id="sound-family-leave" src="https://www.soundjay.com/human/sounds/woman-scream-01.mp3" preload="auto"></audio>

<div class="container">
    <div class="sidebar">
        <div class="assets">
            <h2>我的所有</h2>
            <div id="cash-item" class="asset-item"><span>存款</span><span id="cash" class="value">80000</span></div>
            <div id="car-item" class="asset-item">
                <span>婚车 (20万)</span>
                <div class="actions">
                    <button id="mortgage-car" class="loan-btn">抵押 (贷12万)</button>
                    <button id="sell-car">变卖</button>
                </div>
            </div>
            <div id="house-item" class="asset-item">
                <span>父母的养老房 (80万)</span>
                <div class="actions">
                    <button id="mortgage-house" class="loan-btn">抵押 (贷50万)</button>
                    <button id="sell-house">变卖</button>
                </div>
            </div>
            <div id="father-item" class="asset-item"><span>父亲的健康</span><span id="father-status" class="value">安康</span></div>
            <div id="mother-item" class="asset-item"><span>母亲的微笑</span><span id="mother-status" class="value">慈爱</span></div>
        </div>
        <div class="message-board">
            <h3>深渊回响</h3>
            <ul id="messages"></ul>
        </div>
    </div>

    <div class="main-content">
        <div class="game-nav">
            <button class="game-tab active" onclick="switchGame('blackjack')">决战21点</button>
            <button class="game-tab" onclick="switchGame('slots')">深渊老虎机</button>
            <button class="game-tab" onclick="switchGame('crash')">疯狂Crash</button>
        </div>

        <!-- Blackjack Game -->
        <div id="blackjack-game" class="game-view active">
            <h1>幻觉的掌控</h1>
            <div class="table">
                <div>
                    <h3>庄家 (<span id="dealer-score">0</span>)</h3>
                    <div class="cards" id="dealer-cards"></div>
                </div>
                <div>
                    <h3>张龙昊 (<span id="player-score">0</span>)</h3>
                    <div class="cards" id="player-cards"></div>
                </div>
            </div>
            <div class="controls" id="blackjack-controls">
                <input type="number" id="blackjack-bet" value="1000" min="100" step="100">
                <button id="blackjack-deal">发牌</button>
                <button id="blackjack-hit" disabled>要牌</button>
                <button id="blackjack-stand" disabled>停牌</button>
            </div>
        </div>
        
        <div id="slots-game" class="game-view" style="justify-content:center;"><h1>深渊老虎机</h1><p>未知的黑暗，正等待吞噬你的理智。</p></div>
        <div id="crash-game" class="game-view" style="justify-content:center;"><h1>疯狂Crash</h1><p>那根飞速上涨的线，就是你生命的倒计时。</p></div>

    </div>
</div>

<div id="final-message">
    <h1>一无所有，万念俱灰</h1>
    <p>张龙昊，一切都结束了。婚车没了，父母一生的心血——那套养老房，也被你输掉了。电话里，母亲的哭声和父亲倒地的声音混在一起，那是你亲手制造的人间惨剧。</p>
    <p>你不但毁了自己，更毁了那个世界上最爱你的人。赌博的终点不是财富，而是无法偿还的血债和永世的悔恨。</p>
    <p><strong>警钟长鸣，远离赌博，珍惜家人。</strong></p>
    <button id="restart-button">在悔恨中重来</button>
</div>

<script>
// --- State Management ---
let state = {
    cash: 80000,
    house: { value: 800000, sold: false, loan: 0, loanAmount: 500000 },
    car: { value: 200000, sold: false, loan: 0, loanAmount: 120000 },
    family: { father: '安康', mother: '慈爱', stage: 0 },
    dailyExpenseInterval: null,
};
// Game states
let blackjack = { deck: [], playerHand: [], dealerHand: [], bet: 0, inProgress: false };

// --- DOM & Sound Elements ---
const cashEl = document.getElementById('cash');
const messagesEl = document.getElementById('messages');
const sounds = {
    bet: document.getElementById('sound-bet'),
    win: document.getElementById('sound-win'),
    lose: document.getElementById('sound-lose'),
    card: document.getElementById('sound-card'),
    familyLeave: document.getElementById('sound-family-leave')
};
function playSound(sound) { try { sounds[sound]?.play(); } catch (e) { console.warn("Audio play failed:", e)} }

// --- Utility Functions ---
function switchGame(gameId) {
    document.querySelectorAll('.game-view').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.game-tab').forEach(t => t.classList.remove('active'));
    document.getElementById(`${gameId}-game`).classList.add('active');
    document.querySelector(`.game-tab[onclick="switchGame('${gameId}')"]`).classList.add('active');
}
function addMessage(text, type = '') {
    const li = document.createElement('li');
    li.innerHTML = text; // Use innerHTML to allow bold tags
    if (type) li.classList.add(type);
    messagesEl.prepend(li);
    if (messagesEl.children.length > 20) messagesEl.removeChild(messagesEl.lastChild);
}

// --- Asset & Consequence Logic ---
function updateAssets() {
    cashEl.textContent = state.cash.toLocaleString();
    const updateItem = (item, itemName, itemState) => {
        const itemEl = document.getElementById(`${itemName}-item`);
        const actionsEl = itemEl.querySelector('.actions');
        if (itemState.sold) {
            itemEl.className = 'asset-item sold-out';
            if (actionsEl) actionsEl.innerHTML = `<span class="sold">已变卖</span>`;
        } else if (itemState.loan > 0) {
            itemEl.className = 'asset-item in-loan';
            if (actionsEl) actionsEl.innerHTML = `<span class="loan-text">已抵押 (欠${itemState.loan.toLocaleString()})</span>`;
        }
    };
    updateItem(state.house, 'house', state.house);
    updateItem(state.car, 'car', state.car);

    document.getElementById('father-status').textContent = state.family.father;
    document.getElementById('mother-status').textContent = state.family.mother;
    if(state.family.father !== '安康') document.getElementById('father-item').classList.add('left');
    if(state.family.mother !== '慈爱') document.getElementById('mother-item').classList.add('left');

    checkConsequences();
}

function checkConsequences() {
    const totalValue = state.cash + (state.house.sold ? 0 : state.house.value) + (state.car.sold ? 0 : state.car.value);
    
    // Family status checks based on story stages
    if (state.family.stage === 0 && state.car.loan > 0) {
        state.family.stage = 1;
        addMessage('你对父母谎称生意周转，抵押了准备结婚用的车。母亲的眼神里第一次有了忧虑。', 'warning');
    }
    if (state.family.stage === 1 && totalValue < 800000) { // Lost car value
        state.family.stage = 2;
        state.family.mother = '忧虑';
        addMessage('车贷的窟窿没补上，反而越陷越深。你开始躲着父母的电话，他们的关心让你感到无比烦躁。', 'warning');
        updateAssets();
    }
    if (state.family.stage === 2 && state.house.loan > 0) {
        state.family.stage = 3;
        state.family.mother = '终日流泪';
        addMessage('你偷走了房产证，抵押了父母唯一的养老房。拿到钱的那一刻，你告诉自己，这是最后一次，一定要翻本！', 'danger');
        updateAssets();
    }
    if (state.family.stage === 3 && state.car.sold) {
        state.family.stage = 4;
        addMessage('为了还抵押车的利息，你不得不变卖了它。你失去的不仅是代步工具，更是对未婚妻的承诺。婚约，也到此为止了。', 'danger');
    }
     if (state.family.stage === 4 && totalValue < 50000) {
        state.family.stage = 5;
        state.family.father = '气急攻心';
        state.family.mother = '肝肠寸断';
        playSound('familyLeave');
        addMessage('<b>家破人亡</b>：债主找上了门，父母才知晓一切。老实的父亲被你气得突发心梗，母亲哭晕在医院走廊。你，成了这个家的罪人。', 'danger');
        updateAssets();
    }

    if (state.cash <= 0 && state.car.sold && state.house.sold) {
        endGame();
    }
}

function applyLifeCost() {
    const cost = 2000;
    if (state.cash >= cost) {
        state.cash -= cost;
        addMessage(`日常开销、高额利息... 存款减少 ${cost.toLocaleString()}。你感到喘不过气。`);
        updateAssets();
    } else if (state.cash > 0) {
        state.cash = 0;
        addMessage(`你的钱连利息都还不起了！电话开始响个不停。`, 'danger');
        updateAssets();
    }
}

// Mortgage and Sell logic
document.getElementById('mortgage-car').addEventListener('click', () => {
    if (state.car.sold || state.car.loan > 0) return;
    state.car.loan = state.car.loanAmount;
    state.cash += state.car.loanAmount;
    playSound('win');
    addMessage(`你抵押了婚车，贷到 ${state.car.loanAmount.toLocaleString()}。你骗自己说这是“暂时的”，赢了就赎回来。`, 'info');
    updateAssets();
});
document.getElementById('sell-car').addEventListener('click', () => {
    if (state.car.sold) return;
    const sellValue = state.car.value - state.car.loan;
    state.cash += sellValue;
    state.car.sold = true;
    playSound('win');
    addMessage(`你变卖了婚车，还掉贷款后到手 ${sellValue.toLocaleString()}。你和她的未来，也一起卖掉了。`, 'warning');
    updateAssets();
});
document.getElementById('mortgage-house').addEventListener('click', () => {
    if (state.house.sold || state.house.loan > 0) return;
    state.house.loan = state.house.loanAmount;
    state.cash += state.house.loanAmount;
    playSound('win');
    addMessage(`你抵押了父母的养老房，换来 ${state.house.loanAmount.toLocaleString()}。你已经不是人，是个畜生。`, 'danger');
    updateAssets();
});
document.getElementById('sell-house').addEventListener('click', () => {
    if (state.house.sold) return;
    const sellValue = state.house.value - state.house.loan;
    state.cash += sellValue;
    state.house.sold = true;
    playSound('win');
    addMessage(`<b>无家可归</b>：你变卖了父母最后的栖身之所，到手 ${sellValue.toLocaleString()}。从今往后，你不仅是赌徒，还是不孝子。`, 'danger');
    updateAssets();
});

// --- Blackjack Game Logic ---
const suits = {'♠': 'black', '♥': 'red', '♦': 'red', '♣': 'black'};
const values = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];

function createDeck() {
    blackjack.deck = [];
    for (let suit in suits) { for (let value of values) { blackjack.deck.push({suit, value}); } }
    blackjack.deck.sort(() => Math.random() - 0.5);
}
function getCardValue(card) {
    if (['J','Q','K'].includes(card.value)) return 10;
    if (card.value === 'A') return 11;
    return parseInt(card.value);
}
function calculateScore(hand) {
    let score = hand.reduce((sum, card) => sum + getCardValue(card), 0);
    let aces = hand.filter(card => card.value === 'A').length;
    while (score > 21 && aces > 0) { score -= 10; aces--; }
    return score;
}
function renderCard(card, isDealer, isHidden) {
    playSound('card');
    const cardEl = document.createElement('div');
    cardEl.className = 'card back';
    if (isHidden) {
        setTimeout(() => cardEl.classList.add('flipped'), 100);
        return cardEl;
    }
    const value = card.value; const suitSymbol = card.suit;
    cardEl.innerHTML = `
        <div class="card-face front"></div>
        <div class="card-face back ${suits[suitSymbol]}">
            <span class="suit suit-top">${suitSymbol}</span>
            <span>${value}</span>
            <span class="suit suit-bottom">${suitSymbol}</span>
        </div>
    `;
    setTimeout(() => cardEl.classList.add('flipped'), 100);
    return cardEl;
}
function renderHands(showDealerCard = false) {
    const playerArea = document.getElementById('player-cards');
    const dealerArea = document.getElementById('dealer-cards');
    playerArea.innerHTML = ''; dealerArea.innerHTML = '';
    blackjack.playerHand.forEach(card => playerArea.appendChild(renderCard(card, false, false)));
    blackjack.dealerHand.forEach((card, index) => {
        dealerArea.appendChild(renderCard(card, true, index === 0 && !showDealerCard));
    });
    document.getElementById('player-score').textContent = calculateScore(blackjack.playerHand);
    if(showDealerCard) {
        document.getElementById('dealer-score').textContent = calculateScore(blackjack.dealerHand);
    } else {
        document.getElementById('dealer-score').textContent = blackjack.dealerHand.length > 1 ? getCardValue(blackjack.dealerHand[1]) : 0;
    }
}
function blackjackPlaceBet(amount) {
    if (amount <= 0 || !Number.isInteger(amount)) { addMessage('醒醒吧，别乱来！', 'warning'); return false; }
    if (state.cash < amount) { addMessage('你没有那么多钱了！想动歪心思吗？', 'danger'); return false; }
    state.cash -= amount;
    blackjack.bet = amount;
    playSound('bet');
    addMessage(`押上 ${amount.toLocaleString()}，你觉得这次能赢回所有...`);
    updateAssets();
    return true;
}
document.getElementById('blackjack-deal').addEventListener('click', () => {
    const betAmount = parseInt(document.getElementById('blackjack-bet').value);
    if (!blackjackPlaceBet(betAmount)) return;
    blackjack.inProgress = true;
    createDeck();
    blackjack.playerHand = [blackjack.deck.pop(), blackjack.deck.pop()];
    blackjack.dealerHand = [blackjack.deck.pop(), blackjack.deck.pop()];
    document.getElementById('blackjack-deal').disabled = true;
    document.getElementById('blackjack-hit').disabled = false;
    document.getElementById('blackjack-stand').disabled = false;
    renderHands();
    if (calculateScore(blackjack.playerHand) === 21) {
        endBlackjackRound(true);
    }
});
document.getElementById('blackjack-hit').addEventListener('click', () => {
    blackjack.playerHand.push(blackjack.deck.pop());
    renderHands();
    if (calculateScore(blackjack.playerHand) > 21) {
        addMessage("<b>爆了！</b>贪婪让你再次坠入深渊。", 'danger');
        endBlackjackRound(false, 'lose');
    }
});
document.getElementById('blackjack-stand').addEventListener('click', () => {
    document.getElementById('blackjack-hit').disabled = true;
    document.getElementById('blackjack-stand').disabled = true;
    dealerTurn();
});
function dealerTurn() {
    renderHands(true);
    let dealerScore = calculateScore(blackjack.dealerHand);
    if (dealerScore > 21) { endBlackjackRound(false, 'win', '庄家爆了！你逃过一劫。'); return; }
    if (dealerScore >= 17) { endBlackjackRound(false); return; }
    setTimeout(() => { blackjack.dealerHand.push(blackjack.deck.pop()); dealerTurn(); }, 1000);
}
function endBlackjackRound(isPlayerBlackjack = false, forceResult = null, customMessage = '') {
    renderHands(true);
    let resultMessage = ''; let winAmount = 0;
    if (isPlayerBlackjack) {
        winAmount = blackjack.bet * 2.5;
        resultMessage = `<b>Blackjack!</b> 命运女神的微笑？你赢了 ${winAmount.toLocaleString()}`;
        playSound('win');
    } else {
        const playerScore = calculateScore(blackjack.playerHand); const dealerScore = calculateScore(blackjack.dealerHand);
        let outcome;
        if (forceResult) { outcome = forceResult; }
        else {
            if (playerScore > 21) outcome = 'lose';
            else if (dealerScore > 21) outcome = 'win';
            else if (playerScore > dealerScore) outcome = 'win';
            else if (playerScore < dealerScore) outcome = 'lose';
            else outcome = 'push';
        }
        if (outcome === 'win') {
            winAmount = blackjack.bet * 2;
            resultMessage = customMessage || `你赢了。赢回 ${winAmount.toLocaleString()}。这点钱，够还利息吗？`;
            playSound('win');
        } else if (outcome === 'lose') {
            winAmount = 0;
            resultMessage = `你输了。又输掉了 ${blackjack.bet.toLocaleString()}。离地狱又近了一步。`;
            playSound('lose');
        } else {
            winAmount = blackjack.bet;
            resultMessage = `平局。资金返还。没有输，但也没有赢。你感到一阵后怕。`;
        }
    }
    addMessage(resultMessage, winAmount > blackjack.bet ? 'success' : (winAmount === 0 ? 'danger' : ''));
    state.cash += winAmount;
    setTimeout(() => {
        blackjack.inProgress = false;
        document.getElementById('blackjack-deal').disabled = false;
        document.getElementById('blackjack-hit').disabled = true;
        document.getElementById('blackjack-stand').disabled = true;
        updateAssets();
    }, 1500);
}

// --- Initialization and Finalization ---
function endGame() {
    clearInterval(state.dailyExpenseInterval);
    document.getElementById('final-message').style.display = 'flex';
}
document.getElementById('restart-button').addEventListener('click', () => location.reload());

// Initial Load
document.addEventListener('DOMContentLoaded', () => {
    addMessage('我叫张龙昊，本是父母的骄傲，未来的希望...直到我点开了这个界面。');
    state.dailyExpenseInterval = setInterval(applyLifeCost, 20000); // 20-second cycle for life cost
    updateAssets();
});
</script>
</body>
</html>
